<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Zip Boundaries - Clean</title>

    <style>
      html,body{height:100%;margin:0;}
      body{font-family:system-ui, -apple-system, "Segoe UI", Roboto, "DM Sans", sans-serif;}
      #map{height:100%;width:100%;}
    </style>
  </head>

  <body>
    <div id="map"></div>

    <script>
      let lastHighlighted = null;

      function getZipFromFeature(feature){
        return feature.getProperty('ZCTA5CE20') || feature.getProperty('ZCTA5CE10') || feature.getProperty('GEOID');
      }

      function centerOfFeature(feature){
        const bounds = new google.maps.LatLngBounds();
        let has = false;
        const walk = (g) => {
          const t = g.getType();
          if (t === 'Polygon'){
            g.getArray().forEach(ring => ring.getArray().forEach(pt => { bounds.extend(pt); has = true; }));
          } else if (t === 'MultiPolygon' || t === 'GeometryCollection'){
            g.getArray().forEach(walk);
          } else if (t === 'Point'){
            bounds.extend(g.get()); has = true;
          }
        };
        walk(feature.getGeometry());
        return has ? bounds.getCenter() : null;
      }

      function highlightFeature(map, feature){
        clearHighlight(map);
        lastHighlighted = feature;
        map.data.overrideStyle(feature, { strokeWeight: 3, zIndex: 1000 });
      }
      function clearHighlight(map){
        if (lastHighlighted){ map.data.revertStyle(lastHighlighted); lastHighlighted = null; }
      }

      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 10,
          center: { lat: 39.9526, lng: -75.1652 },
          disableDefaultUI: true,
          zoomControl: true
        });

        map.data.loadGeoJson('zip-map.json', null, () => {
          map.data.setStyle((feature) => {
            return {
              fillColor: 'transparent',
              fillOpacity: 0,
              strokeColor: '#444',
              strokeWeight: 1.2
            };
          });
        });

        map.data.addListener('click', (e) => {
          highlightFeature(map, e.feature);
        });

        map.data.addListener('mouseover', (e) => {
          map.data.overrideStyle(e.feature, { strokeWeight: 2.6 });
        });
        map.data.addListener('mouseout', (e) => {
          if (lastHighlighted !== e.feature) map.data.revertStyle(e.feature);
        });
      }

      window.initMap = initMap;
    </script>

    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDihHSv5KORtpnnMC7umGgXWBJm5NSduc8&callback=initMap&libraries=geometry">
    </script>
  </body>
</html>
