<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Zip Boundaries - Clean (v3)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      html,body{height:100%;margin:0;}
      body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "DM Sans", sans-serif; background:#f6f8fa;}
      #map{height:100vh;width:100%;}
      #debug{position:fixed;left:12px;bottom:12px;z-index:10000;background:rgba(255,255,255,0.95);padding:10px;border-radius:10px;font-size:12px;max-width:360px;max-height:200px;overflow:auto;box-shadow:0 6px 18px rgba(20,30,40,0.08);border:1px solid rgba(20,30,40,0.04);}
      #debug strong{display:block;margin-bottom:6px;}
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="debug" aria-hidden="false"><strong>Debug console</strong><small id="dbg"></small></div>

    <script>
      const dbg = (msg) => {
        console.log(msg);
        const el = document.getElementById('dbg');
        el.innerHTML += msg + '<br/>';
      };

      let lastHighlighted = null;
      const THEME_COLOR = '#2F80ED'; // friendly modern blue
      const OUTLINE_WEIGHT = 3.5;
      const HOVER_WEIGHT = 4.5;
      const ACTIVE_WEIGHT = 5.5;
      const FILL_OPACITY = 0.06; // subtle fill

      function highlightFeature(map, feature){
        clearHighlight(map);
        lastHighlighted = feature;
        map.data.overrideStyle(feature, { strokeWeight: 0, fillOpacity: 0 });
      }
      function clearHighlight(map){
        if (lastHighlighted){ map.data.revertStyle(lastHighlighted); lastHighlighted = null; }
      }

      function initMap() {
        // Map style to hide POI labels/icons like restaurants, museums, shops
                        const minimalMapStyle = [
            {
                "featureType": "all",
                "elementType": "labels.text",
                "stylers": [{ "color": "#878787" }]
            },
            {
                "featureType": "all",
                "elementType": "labels.text.stroke",
                "stylers": [{ "visibility": "off" }]
            },
            {
                "featureType": "landscape",
                "elementType": "all",
                "stylers": [{ "color": "#f9f5ed" }]
            },
            {
                "featureType": "road.highway",
                "elementType": "all",
                "stylers": [{ "color": "#f5f5f5" }]
            },
            {
                "featureType": "road.highway",
                "elementType": "geometry.stroke",
                "stylers": [{ "color": "#c9c9c9" }]
            },
            {
                "featureType": "water",
                "elementType": "all",
                "stylers": [{ "color": "#aee0f4" }]
            }
        
            ,
            {
                "featureType": "poi.business",
                "elementType": "labels",
                "stylers": [{ "visibility": "off" }]
            },
            {
                "featureType": "poi.business",
                "elementType": "labels.icon",
                "stylers": [{ "visibility": "off" }]
            },
            {
                "featureType": "poi.attraction",
                "elementType": "labels",
                "stylers": [{ "visibility": "off" }]
            },
            {
                "featureType": "poi.attraction",
                "elementType": "labels.icon",
                "stylers": [{ "visibility": "off" }]
            }

            ,
            {
                "featureType": "road.local",
                "elementType": "labels",
                "stylers": [{ "visibility": "off" }]
            },
            {
                "featureType": "road.local",
                "elementType": "geometry",
                "stylers": [{ "color": "#f3f3f3" }]
            },
            {
                "featureType": "road.arterial",
                "elementType": "labels.text.fill",
                "stylers": [{ "color": "#9a9a9a" }]
            },
            {
                "featureType": "road.arterial",
                "elementType": "labels.icon",
                "stylers": [{ "visibility": "off" }]
            }
];

        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 10,
          center: { lat: 39.9526, lng: -75.1652 },
          disableDefaultUI: true,
          zoomControl: true,
          styles: minimalMapStyle,
        });

        // Base styling for all loaded GeoJSON features
        map.data.setStyle(() => ({
          fillColor: THEME_COLOR,
          fillOpacity: 0,
          strokeColor: THEME_COLOR,
          strokeWeight: 0,
          zIndex: 0
        }));

        map.data.addListener('click', (e) => {
          highlightFeature(map, e.feature);
        });
        map.data.addListener('mouseover', (e) => {
          // on hover, subtly emphasize
          map.data.overrideStyle(e.feature, { strokeWeight: 0, fillOpacity: 0 });
        });
        map.data.addListener('mouseout', (e) => {
          if (lastHighlighted !== e.feature) map.data.revertStyle(e.feature);
        });

        dbg('Attempting to fetch zip-map.json (relative path).');
        fetch('zip-map.json')
          .then(resp => {
            if (!resp.ok) throw new Error('Network response was not ok: ' + resp.status + ' ' + resp.statusText);
            const ct = resp.headers.get('content-type') || '';
            dbg('Received: ' + resp.status + ' Content-Type: ' + ct);
            return resp.json();
          })
          .then(data => {
            dbg('Successfully fetched GeoJSON — adding to map.');
            map.data.addGeoJson(data);
            try {
              const bounds = new google.maps.LatLngBounds();
              const addCoords = (coords) => {
                coords.forEach(pt => {
                  if (typeof pt[0] === 'number' && typeof pt[1] === 'number') {
                    bounds.extend(new google.maps.LatLng(pt[1], pt[0]));
                  } else {
                    addCoords(pt);
                  }
                });
              };
              if (data.type === 'FeatureCollection') {
                data.features.forEach(f => { if (f.geometry) addCoords(f.geometry.coordinates); });
              } else if (data.geometry) {
                addCoords(data.geometry.coordinates);
              } else if (data.coordinates) {
                addCoords(data.coordinates);
              }
              if (!bounds.isEmpty()) {
                map.fitBounds(bounds);
                dbg('Fitted map to GeoJSON bounds.');
              } else {
                dbg('GeoJSON bounds were empty; using default center/zoom.');
              }
            } catch (err) {
              console.error(err);
              dbg('Error computing bounds: ' + err.message);
            }
          })
          .catch(err => {
            console.error('Failed to load zip-map.json', err);
            dbg('Error loading zip-map.json: ' + err.message + 
                '<br/><strong>Common causes:</strong> viewing via GitHub file preview will NOT render as an app — use GitHub Pages or a local server. Also check CORS, file path, and API key restrictions.');
          });

        dbg('If map tiles/errors appear, open DevTools Console for detailed errors (API key, CORS, blocked by referrer, etc.).');
      }

      window.initMap = initMap;
    </script>

    <!-- Replace API key with YOUR_API_KEY_HERE if you prefer not to expose a key in the file -->
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDihHSv5KORtpnnMC7umGgXWBJm5NSduc8&callback=initMap">
    </script>
  </body>
</html>
